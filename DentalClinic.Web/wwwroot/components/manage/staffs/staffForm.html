<div class="pa-4 rounded-lg form-style-1">
    <div class="form-header d-flex align-center justify-space-between">
        <span class="text-h6">{{ formTitle }}</span>
        <div v-if="isEditMode" class="d-flex align-center">
            <v-label for="status-switch" class="me-2 text-body-2">Trạng thái:</v-label>
            <v-switch
                id="status-switch"
                v-model="staff.isActive"
                :label="staff.isActive ? 'Đang hoạt động' : 'Đã khóa'"
                color="success"
                inset
                hide-details
            ></v-switch>
        </div>
    </div>
    <div class="form-body">
        <v-form @submit.prevent="saveStaff" ref="staffForm">
            <v-row>
                <v-col cols="12" md="6">
                    <v-text-field label="Họ và Tên" v-model="staff.fullName" variant="outlined"
                        :rules="[rules.required]"></v-text-field>
                    <v-select label="Chi nhánh" v-model="staff.branchIds" :items="branches" item-title="branchName"
                        item-value="branchId" variant="outlined" required multiple chips closable-chips :rules="[rules.requiredBranches]"
                        placeholder="Chọn một chi nhánh" class="mb-4">

                        <template v-slot:item="{ props, item }">
                            <v-list-item 
                                v-bind="props"
                                :title="item.raw.branchName"
                                :subtitle="!item.raw.isActive ? 'Đã vô hiệu' : null"
                                :disabled="!item.raw.isActive"
                                
                            ></v-list-item>
                        </template>
                    </v-select>
                    <v-text-field label="Tên đăng nhập" v-model="staff.username" variant="outlined"
                        :rules="[rules.required]" :disabled="isEditMode"></v-text-field>
                    <!-- Chỉ hiển thị mật khẩu khi tạo mới -->
                    <v-text-field v-if="!isEditMode" label="Mật khẩu" v-model="staff.password" variant="outlined"
                        type="password" :rules="[rules.required, rules.minLength]"></v-text-field>
                </v-col>
                <v-col cols="12" md="6">
                    <v-text-field label="Điện thoại" v-model="staff.phone" variant="outlined"></v-text-field>
                    <v-select label="Chức danh/Vai trò" v-model="staff.roleIds" :items="roles" item-title="name"
                        item-value="roleId" variant="outlined" required multiple chips :rules="[rules.requiredRoles]"
                        placeholder="Chọn một vai trò" class="mb-4">
                    </v-select>
                    <v-text-field label="Email" v-model="staff.email" variant="outlined"
                        :rules="[rules.required, rules.email]"></v-text-field>
                </v-col>
            </v-row>

            <v-alert v-if="error" type="error" dense class="mb-4" closable @click:close="error = null">
                {{ error }}
            </v-alert> 
            <div class="form-footer">
                <v-btn @click="goBack" class="btn-secondary">Hủy</v-btn>
                <v-btn type="submit" color="primary" class="btn-primary mr-2" :loading="loading">
                    Lưu Thay Đổi
                </v-btn>
            </div>
        </v-form>
    </div>

    <!-- Message Dialog for confirmations and notifications -->
    <message-dialog v-model="showDialog" :type="dialogConfig.type" :title="dialogConfig.title"
        :message="dialogConfig.message" :show-cancel="dialogConfig.showCancel" :loading="dialogConfig.loading"
        :ok-text="dialogConfig.okText" :cancel-text="dialogConfig.cancelText" @ok="dialogConfig.onOk"
        @cancel="dialogConfig.onCancel">
    </message-dialog>
</div>