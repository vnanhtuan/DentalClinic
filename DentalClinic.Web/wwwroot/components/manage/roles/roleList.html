<!-- Bắt đầu file: wwwroot/components/manage/roleList.html -->
<v-card class="pa-4 table-style-1" rounded="lg">
    <v-card-title class="d-flex flex-column flex-sm-row justify-space-between align-start align-sm-center ga-3">
        <span class="text-h6">Quản lý vai trò</span>
        <v-btn color="primary" @click="openCreateDialog" class="btn-primary" prepend-icon="mdi-account-lock-outline">
            <span class="d-none d-sm-inline">Thêm vai trò mới</span>
            <span class="d-inline d-sm-none">Thêm</span>
        </v-btn>
    </v-card-title>

    <v-card-text class="pa-0 pa-sm-4">
        <v-skeleton-loader v-if="loading" type="table" class="mx-auto"></v-skeleton-loader>

        <!-- Data Table (Desktop và Mobile dùng chung vì ít cột) -->
        <div v-else class="scrollable-card-text">
            <v-data-table :headers="headers" :items="roles" item-value="roleId" class="elevation-1" :loading="loading"
                loading-text="Đang tải dữ liệu..." no-data-text="Không tìm thấy vai trò nào" :items-per-page="pageSize"
                density="comfortable" hover>

                <template v-slot:item.stt="{ index }">
                    <span>{{ index + 1 }}</span>
                </template>
                <template v-slot:item.name="{ item }">
                    <v-chip :color="item.color" size="small">
                        {{ item.name }}
                    </v-chip>
                </template>
                <!-- Cột Hành động (Edit/Delete) -->
                <template v-slot:item.actions="{ item }">
                    <div class="d-flex ga-1 justify-end">
                        <v-tooltip location="top" text="Chỉnh sửa">
                            <template v-slot:activator="{ props }">
                                <v-btn v-bind="props" icon="mdi-pencil" variant="text" color="info" size="small"
                                    @click="openEditDialog(item)"></v-btn>
                            </template>
                        </v-tooltip>
                        <v-tooltip location="top" text="Xóa">
                            <template v-slot:activator="{ props }">
                                <v-btn v-if="item.name !== 'Admin'" v-bind="props" icon="mdi-delete" variant="text"
                                    color="error" size="small" @click="confirmDelete(item)"></v-btn>
                            </template>
                        </v-tooltip>
                    </div>
                </template>
            </v-data-table>
        </div>
    </v-card-text>
    <message-dialog v-model="showDialog" :type="dialogConfig.type" :title="dialogConfig.title"
        :message="dialogConfig.message" :show-cancel="dialogConfig.showCancel" :loading="dialogConfig.loading"
        :ok-text="dialogConfig.okText" :cancel-text="dialogConfig.cancelText" @ok="dialogConfig.onOk"
        @cancel="dialogConfig.onCancel">
    </message-dialog>

    <v-dialog v-model="showFormDialog" max-width="600px" persistent class="dialog-form">
        <v-card class="rounded-lg">
            <v-form @submit.prevent="saveRole" ref="roleForm">
                <v-card-title class="d-flex align-center pa-4">
                    <v-icon icon="mdi-account-box-edit-outline mdi v-icon" size="24" class="me-3"></v-icon>
                    <span class="text-h6 font-weight-bold">{{ formTitle }}</span>
                    <v-spacer></v-spacer>            
                    <v-btn 
                        icon="mdi-close" 
                        variant="text" 
                        size="small" 
                        @click="closeFormDialog"
                        :disabled="formLoading"
                        >
                    </v-btn>
                </v-card-title>
                <v-card-text class="pa-6">
                    <v-container>
                        <v-row>
                            <v-col cols="12" md="8">
                                <v-text-field label="Tên vai trò (RoleName)" v-model="editedRole.name"
                                    variant="outlined" required :rules="[rules.required]"
                                    hint="Ví dụ: Admin, Doctor, Receptionist" persistent-hint class="mb-4">
                                </v-text-field>
                            </v-col>
                            <v-col cols="12" md="4">
                                <v-text-field label="Màu sắc" v-model="editedRole.color" variant="outlined"
                                    hint="Ví dụ: #2f362f, #f8faf9" persistent-hint class="mb-4">
                                </v-text-field>
                            </v-col>
                            <v-col cols="12">
                                <v-textarea label="Mô tả" v-model="editedRole.description" variant="outlined" rows="3">
                                </v-textarea>
                            </v-col>
                        </v-row>
                    </v-container>
                    <v-alert v-if="formError" type="error" dense class="mt-2" closable @click:close="formError = null">
                        {{ formError }}
                    </v-alert>
                </v-card-text>

                <v-card-actions class="pa-4 pt-0">
                    <v-spacer></v-spacer>
                    <v-btn @click="closeFormDialog" variant="outlined" class="me-2">
                        Hủy
                    </v-btn>
                    <v-btn type="submit" variant="elevated" :loading="formLoading">
                        Lưu
                    </v-btn>
                </v-card-actions>
            </v-form>
        </v-card>
    </v-dialog>
</v-card>
