<!-- Test page for Message Dialog Loading States -->
<!DOCTYPE html>
<html>
<head>
    <title>Dialog Loading Test</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/vuetify@3.4.4/dist/vuetify.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/vuetify@3.4.4/dist/vuetify.min.js"></script>
</head>
<body>
    <div id="app">
        <v-app>
            <v-main>
                <v-container>
                    <h1>Message Dialog Loading Test</h1>
                    
                    <v-btn @click="testLoadingDialog" color="primary" class="ma-2">
                        Test Loading Dialog
                    </v-btn>
                    
                    <v-btn @click="testSimpleDialog" color="secondary" class="ma-2">
                        Test Simple Dialog  
                    </v-btn>

                    <!-- Dialog Component -->
                    <v-dialog v-model="showDialog" max-width="500px" :persistent="dialogConfig.loading" no-click-animation>
                        <v-card rounded="lg" elevation="8" :class="{ 'dialog-loading': dialogConfig.loading }">
                            <!-- Loading Overlay -->
                            <v-overlay v-if="dialogConfig.loading" contained class="d-flex align-center justify-center">
                                <div class="text-center">
                                    <v-progress-circular 
                                        indeterminate 
                                        color="primary" 
                                        size="48"
                                        width="4">
                                    </v-progress-circular>
                                    <div class="text-body-2 mt-3 text-medium-emphasis">Đang xử lý...</div>
                                </div>
                            </v-overlay>

                            <!-- Dialog Header -->
                            <v-card-title class="d-flex align-center pa-4">
                                <v-icon icon="mdi-information" size="24" class="me-3"></v-icon>
                                <span class="text-h6 font-weight-bold">{{ dialogConfig.title }}</span>
                                <v-spacer></v-spacer>
                                <v-btn 
                                    icon="mdi-close" 
                                    variant="text" 
                                    size="small" 
                                    @click="closeDialog"
                                    :disabled="dialogConfig.loading">
                                </v-btn>
                            </v-card-title>

                            <!-- Dialog Content -->
                            <v-card-text class="pa-6">
                                <div class="text-body-1" v-html="dialogConfig.message"></div>
                            </v-card-text>

                            <!-- Dialog Actions -->
                            <v-card-actions class="pa-4 pt-0">
                                <v-spacer></v-spacer>
                                
                                <v-btn 
                                    v-if="dialogConfig.showCancel"
                                    variant="outlined" 
                                    @click="closeDialog"
                                    :disabled="dialogConfig.loading"
                                    class="me-2">
                                    {{ dialogConfig.cancelText }}
                                </v-btn>
                                
                                <v-btn 
                                    color="primary"
                                    variant="elevated"
                                    @click="handleOk"
                                    :loading="dialogConfig.loading"
                                    :disabled="dialogConfig.loading">
                                    {{ dialogConfig.okText }}
                                </v-btn>
                            </v-card-actions>
                        </v-card>
                    </v-dialog>
                </v-container>
            </v-main>
        </v-app>
    </div>

    <script>
        const { createApp } = Vue;
        const { createVuetify } = Vuetify;

        const vuetify = createVuetify();

        createApp({
            data() {
                return {
                    showDialog: false,
                    dialogConfig: {
                        type: 'info',
                        title: '',
                        message: '',
                        showCancel: false,
                        loading: false,
                        okText: 'Đồng ý',
                        cancelText: 'Hủy',
                    }
                };
            },
            methods: {
                testLoadingDialog() {
                    this.dialogConfig = {
                        type: 'info',
                        title: 'Test Loading Dialog',
                        message: 'Click OK to simulate a 3-second server operation. Notice how the dialog prevents interaction.',
                        showCancel: true,
                        loading: false,
                        okText: 'Start Operation',
                        cancelText: 'Cancel'
                    };
                    this.showDialog = true;
                },
                
                testSimpleDialog() {
                    this.dialogConfig = {
                        type: 'info',
                        title: 'Simple Dialog',
                        message: 'This is a simple dialog without loading state.',
                        showCancel: false,
                        loading: false,
                        okText: 'OK',
                        cancelText: 'Cancel'
                    };
                    this.showDialog = true;
                },
                
                handleOk() {
                    if (this.dialogConfig.loading) {
                        return; // Prevent multiple clicks
                    }
                    
                    // Start loading
                    this.dialogConfig.loading = true;
                    
                    // Simulate server operation
                    setTimeout(() => {
                        // Operation completed
                        this.dialogConfig.loading = false;
                        this.showDialog = false;
                        
                        // Show success message
                        setTimeout(() => {
                            this.dialogConfig = {
                                type: 'success',
                                title: 'Success',
                                message: 'Operation completed successfully!',
                                showCancel: false,
                                loading: false,
                                okText: 'Great!',
                                cancelText: 'Cancel'
                            };
                            this.showDialog = true;
                        }, 500);
                    }, 3000);
                },
                
                closeDialog() {
                    if (this.dialogConfig.loading) {
                        return; // Prevent closing during loading
                    }
                    this.showDialog = false;
                }
            }
        }).use(vuetify).mount('#app');
    </script>

    <style>
        .dialog-loading .v-card-title, 
        .dialog-loading .v-card-text {
            opacity: 0.7;
            pointer-events: none;
        }

        .v-overlay.v-overlay--contained {
            background-color: rgba(255, 255, 255, 0.9) !important;
            backdrop-filter: blur(2px);
        }
    </style>
</body>
</html>
